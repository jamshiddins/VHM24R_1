<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VHM24R - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .glassmorphism { background: rgba(255, 255, 255, 0.25); backdrop-filter: blur(4px); }
        .tab-active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div id="app" class="max-w-md mx-auto min-h-screen">
        <!-- Header -->
        <div class="gradient-bg text-white p-4 sticky top-0 z-50">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-xl font-bold">üöÄ VHM24R</h1>
                    <p class="text-sm opacity-90">–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞–º–∏</p>
                </div>
                <div class="text-right">
                    <div class="w-10 h-10 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                        <i class="fas fa-user text-white"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="bg-white shadow-sm">
            <div class="flex overflow-x-auto">
                <button onclick="showTab('dashboard')" id="tab-dashboard" class="tab-active px-4 py-3 text-sm font-medium whitespace-nowrap">
                    üìä –î–∞—à–±–æ—Ä–¥
                </button>
                <button onclick="showTab('upload')" id="tab-upload" class="px-4 py-3 text-sm font-medium whitespace-nowrap hover:bg-gray-100">
                    üì§ –ó–∞–≥—Ä—É–∑–∫–∞
                </button>
                <button onclick="showTab('orders')" id="tab-orders" class="px-4 py-3 text-sm font-medium whitespace-nowrap hover:bg-gray-100">
                    üìã –ó–∞–∫–∞–∑—ã
                </button>
                <button onclick="showTab('export')" id="tab-export" class="px-4 py-3 text-sm font-medium whitespace-nowrap hover:bg-gray-100">
                    üìä –≠–∫—Å–ø–æ—Ä—Ç
                </button>
            </div>
        </div>

        <!-- Content -->
        <div class="p-4">
            <!-- Dashboard Tab -->
            <div id="content-dashboard" class="tab-content">
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="bg-white rounded-xl p-4 text-center shadow">
                        <div class="text-2xl font-bold text-blue-600">156</div>
                        <div class="text-sm text-gray-600">–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</div>
                    </div>
                    <div class="bg-white rounded-xl p-4 text-center shadow">
                        <div class="text-2xl font-bold text-green-600">23</div>
                        <div class="text-sm text-gray-600">–§–∞–π–ª–æ–≤</div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl p-4 shadow mb-4">
                    <h3 class="font-semibold mb-3">üìà –ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
                    <div class="space-y-2">
                        <div class="flex items-center space-x-3 p-2 bg-gray-50 rounded">
                            <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                                <i class="fas fa-upload text-blue-600 text-xs"></i>
                            </div>
                            <div>
                                <div class="text-sm font-medium">–ó–∞–≥—Ä—É–∂–µ–Ω —Ñ–∞–π–ª orders.csv</div>
                                <div class="text-xs text-gray-500">2 —á–∞—Å–∞ –Ω–∞–∑–∞–¥</div>
                            </div>
                        </div>
                        <div class="flex items-center space-x-3 p-2 bg-gray-50 rounded">
                            <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">
                                <i class="fas fa-check text-green-600 text-xs"></i>
                            </div>
                            <div>
                                <div class="text-sm font-medium">–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ 45 –∑–∞–∫–∞–∑–æ–≤</div>
                                <div class="text-xs text-gray-500">5 —á–∞—Å–æ–≤ –Ω–∞–∑–∞–¥</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Upload Tab -->
            <div id="content-upload" class="tab-content hidden">
                <div class="bg-white rounded-xl p-6 shadow">
                    <h3 class="font-semibold mb-4">üì§ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤</h3>
                    
                    <div class="border-2 border-dashed border-blue-300 rounded-lg p-8 text-center">
                        <input type="file" id="file-input" multiple accept=".csv,.xlsx,.json" class="hidden">
                        <i class="fas fa-cloud-upload-alt text-4xl text-blue-400 mb-4"></i>
                        <p class="text-lg font-medium mb-2">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª—ã</p>
                        <p class="text-sm text-gray-500 mb-4">CSV, Excel, JSON, XML, PDF</p>
                        <button onclick="document.getElementById('file-input').click()" class="bg-blue-600 text-white px-4 py-2 rounded">
                            –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª—ã
                        </button>
                    </div>
                </div>
            </div>

            <!-- Orders Tab -->
            <div id="content-orders" class="tab-content hidden">
                <div class="space-y-3">
                    <div class="bg-white rounded-lg p-4 shadow">
                        <div class="flex justify-between items-center mb-2">
                            <div class="font-medium">#ORD-2025-001</div>
                            <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</span>
                        </div>
                        <div class="text-sm text-gray-600">–ê–≤—Ç–æ–º–∞—Ç: VM-001</div>
                        <div class="text-sm font-medium">2,500 ‚Ç∏</div>
                    </div>
                    
                    <div class="bg-white rounded-lg p-4 shadow">
                        <div class="flex justify-between items-center mb-2">
                            <div class="font-medium">#ORD-2025-002</div>
                            <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded">–í –æ–±—Ä–∞–±–æ—Ç–∫–µ</span>
                        </div>
                        <div class="text-sm text-gray-600">–ê–≤—Ç–æ–º–∞—Ç: VM-002</div>
                        <div class="text-sm font-medium">1,800 ‚Ç∏</div>
                    </div>
                </div>
            </div>

            <!-- Export Tab -->
            <div id="content-export" class="tab-content hidden">
                <div class="bg-white rounded-xl p-6 shadow">
                    <h3 class="font-semibold mb-4">üìä –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h3>
                    
                    <div class="space-y-4">
                        <select class="w-full p-3 border rounded-lg">
                            <option>–ó–∞–∫–∞–∑—ã</option>
                            <option>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</option>
                            <option>–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π</option>
                        </select>
                        
                        <div class="grid grid-cols-2 gap-2">
                            <button class="p-3 border rounded-lg text-center hover:bg-blue-50">
                                <i class="fas fa-file-csv text-green-600"></i>
                                <div class="text-sm">CSV</div>
                            </button>
                            <button class="p-3 border rounded-lg text-center hover:bg-blue-50">
                                <i class="fas fa-file-excel text-green-600"></i>
                                <div class="text-sm">Excel</div>
                            </button>
                        </div>
                        
                        <button onclick="generateReport()" class="w-full bg-green-600 text-white py-3 rounded-lg">
                            üìä –°–æ–∑–¥–∞—Ç—å –æ—Ç—á—ë—Ç
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let authToken = null;
        let currentUser = null;
        let isAuthenticated = false;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        const tg = window.Telegram?.WebApp;
        if (tg) {
            tg.ready();
            tg.expand();
            
            // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram
            const telegramUser = tg.initDataUnsafe?.user;
            if (telegramUser) {
                console.log('Telegram user:', telegramUser);
                authenticateUser(telegramUser);
            }
        }

        // –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function authenticateUser(telegramUser) {
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω
                const savedToken = localStorage.getItem('auth_token');
                if (savedToken) {
                    authToken = savedToken;
                    await loadUserData();
                    if (isAuthenticated) {
                        showMainInterface();
                        return;
                    }
                }

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
                const urlParams = new URLSearchParams(window.location.search);
                const autoToken = urlParams.get('token');
                if (autoToken) {
                    authToken = autoToken;
                    localStorage.setItem('auth_token', autoToken);
                    await loadUserData();
                    if (isAuthenticated) {
                        // –û—á–∏—â–∞–µ–º URL –æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
                        window.history.replaceState({}, document.title, window.location.pathname);
                        showMainInterface();
                        return;
                    }
                }

                // –ï—Å–ª–∏ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –≤—Ö–æ–¥–µ —á–µ—Ä–µ–∑ –±–æ—Ç–∞
                showTelegramLoginMessage();
                
            } catch (error) {
                console.error('Authentication error:', error);
                showTelegramLoginMessage();
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function loadUserData() {
            try {
                const response = await fetch('/api/v1/auth/me', {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    currentUser = await response.json();
                    isAuthenticated = true;
                    updateUserInterface();
                } else {
                    // –¢–æ–∫–µ–Ω –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω
                    localStorage.removeItem('auth_token');
                    authToken = null;
                    isAuthenticated = false;
                }
            } catch (error) {
                console.error('Error loading user data:', error);
                isAuthenticated = false;
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –≤—Ö–æ–¥–µ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞
        function showTelegramLoginMessage() {
            document.getElementById('app').innerHTML = `
                <div class="min-h-screen flex items-center justify-center bg-gray-100">
                    <div class="bg-white p-8 rounded-xl shadow-lg max-w-md w-full mx-4 text-center">
                        <div class="mb-6">
                            <div class="w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fab fa-telegram text-blue-600 text-3xl"></i>
                            </div>
                            <h1 class="text-2xl font-bold text-gray-800 mb-2">üöÄ VHM24R</h1>
                            <p class="text-gray-600">–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞–º–∏</p>
                        </div>
                        
                        <div class="mb-6">
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                                <h3 class="font-semibold text-blue-800 mb-2">–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–∏—Å—Ç–µ–º–µ:</h3>
                                <ol class="text-sm text-blue-700 text-left space-y-1">
                                    <li>1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Telegram –±–æ—Ç @VHM24R_bot</li>
                                    <li>2. –ù–∞–∂–º–∏—Ç–µ /start</li>
                                    <li>3. –ü–æ–ª—É—á–∏—Ç–µ —Å—Å—ã–ª–∫—É –¥–ª—è –≤—Ö–æ–¥–∞</li>
                                    <li>4. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Å—ã–ª–∫—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ</li>
                                </ol>
                            </div>
                        </div>
                        
                        <button onclick="checkAuthentication()" class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors">
                            üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
                        </button>
                        
                        <div class="mt-4">
                            <a href="https://t.me/VHM24R_bot" target="_blank" class="inline-flex items-center text-blue-600 hover:text-blue-800">
                                <i class="fab fa-telegram mr-2"></i>
                                –û—Ç–∫—Ä—ã—Ç—å Telegram –±–æ—Ç
                            </a>
                        </div>
                    </div>
                </div>
            `;
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
        function showMainInterface() {
            document.getElementById('app').innerHTML = `
                <!-- Header -->
                <div class="gradient-bg text-white p-4 sticky top-0 z-50">
                    <div class="flex items-center justify-between">
                        <div>
                            <h1 class="text-xl font-bold">üöÄ VHM24R</h1>
                            <p class="text-sm opacity-90">–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞–º–∏</p>
                        </div>
                        <div class="text-right">
                            <div class="w-10 h-10 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                <i class="fas fa-user text-white"></i>
                            </div>
                            <div class="text-xs mt-1" id="user-info">
                                ${currentUser?.username || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Navigation -->
                <div class="bg-white shadow-sm">
                    <div class="flex overflow-x-auto">
                        <button onclick="showTab('dashboard')" id="tab-dashboard" class="tab-active px-4 py-3 text-sm font-medium whitespace-nowrap">
                            üìä –î–∞—à–±–æ—Ä–¥
                        </button>
                        <button onclick="showTab('upload')" id="tab-upload" class="px-4 py-3 text-sm font-medium whitespace-nowrap hover:bg-gray-100">
                            üì§ –ó–∞–≥—Ä—É–∑–∫–∞
                        </button>
                        <button onclick="showTab('orders')" id="tab-orders" class="px-4 py-3 text-sm font-medium whitespace-nowrap hover:bg-gray-100">
                            üìã –ó–∞–∫–∞–∑—ã
                        </button>
                        <button onclick="showTab('export')" id="tab-export" class="px-4 py-3 text-sm font-medium whitespace-nowrap hover:bg-gray-100">
                            üìä –≠–∫—Å–ø–æ—Ä—Ç
                        </button>
                        ${currentUser?.role === 'admin' ? `
                        <button onclick="showTab('admin')" id="tab-admin" class="px-4 py-3 text-sm font-medium whitespace-nowrap hover:bg-gray-100">
                            üëë –ê–¥–º–∏–Ω
                        </button>
                        ` : ''}
                    </div>
                </div>

                <!-- Content -->
                <div class="p-4">
                    <!-- Dashboard Tab -->
                    <div id="content-dashboard" class="tab-content">
                        <div class="grid grid-cols-2 gap-4 mb-6">
                            <div class="bg-white rounded-xl p-4 text-center shadow">
                                <div class="text-2xl font-bold text-blue-600" id="total-orders">-</div>
                                <div class="text-sm text-gray-600">–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</div>
                            </div>
                            <div class="bg-white rounded-xl p-4 text-center shadow">
                                <div class="text-2xl font-bold text-green-600" id="total-files">-</div>
                                <div class="text-sm text-gray-600">–§–∞–π–ª–æ–≤</div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-xl p-4 shadow mb-4">
                            <h3 class="font-semibold mb-3">üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                            <div id="dashboard-stats">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                        </div>
                    </div>

                    <!-- Upload Tab -->
                    <div id="content-upload" class="tab-content hidden">
                        <div class="bg-white rounded-xl p-6 shadow">
                            <h3 class="font-semibold mb-4">üì§ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤</h3>
                            
                            <div class="border-2 border-dashed border-blue-300 rounded-lg p-8 text-center">
                                <input type="file" id="file-input" multiple accept=".csv,.xlsx,.json,.xml,.pdf" class="hidden">
                                <i class="fas fa-cloud-upload-alt text-4xl text-blue-400 mb-4"></i>
                                <p class="text-lg font-medium mb-2">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª—ã</p>
                                <p class="text-sm text-gray-500 mb-4">CSV, Excel, JSON, XML, PDF</p>
                                <button onclick="document.getElementById('file-input').click()" class="bg-blue-600 text-white px-4 py-2 rounded">
                                    –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª—ã
                                </button>
                            </div>
                            
                            <div id="upload-progress" class="hidden mt-4">
                                <div class="bg-gray-200 rounded-full h-2">
                                    <div id="progress-bar" class="bg-blue-600 h-2 rounded-full" style="width: 0%"></div>
                                </div>
                                <p class="text-sm text-gray-600 mt-2" id="upload-status">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Orders Tab -->
                    <div id="content-orders" class="tab-content hidden">
                        <div id="orders-list">
                            <div class="text-center py-8">
                                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"></div>
                                <p class="text-gray-600">–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Export Tab -->
                    <div id="content-export" class="tab-content hidden">
                        <div class="bg-white rounded-xl p-6 shadow">
                            <h3 class="font-semibold mb-4">üìä –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h3>
                            
                            <div class="space-y-4">
                                <select id="export-type" class="w-full p-3 border rounded-lg">
                                    <option value="orders">–ó–∞–∫–∞–∑—ã</option>
                                    <option value="analytics">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</option>
                                    <option value="files">–ò—Å—Ç–æ—Ä–∏—è —Ñ–∞–π–ª–æ–≤</option>
                                </select>
                                
                                <div class="grid grid-cols-2 gap-2">
                                    <button onclick="exportData('csv')" class="p-3 border rounded-lg text-center hover:bg-blue-50">
                                        <i class="fas fa-file-csv text-green-600"></i>
                                        <div class="text-sm">CSV</div>
                                    </button>
                                    <button onclick="exportData('excel')" class="p-3 border rounded-lg text-center hover:bg-blue-50">
                                        <i class="fas fa-file-excel text-green-600"></i>
                                        <div class="text-sm">Excel</div>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Admin Tab -->
                    ${currentUser?.role === 'admin' ? `
                    <div id="content-admin" class="tab-content hidden">
                        <div class="space-y-4">
                            <div class="bg-white rounded-xl p-6 shadow">
                                <h3 class="font-semibold mb-4">üëë –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h3>
                                
                                <div class="grid grid-cols-1 gap-4">
                                    <button onclick="loadPendingUsers()" class="p-4 border rounded-lg text-left hover:bg-gray-50">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <div class="font-medium">üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</div>
                                                <div class="text-sm text-gray-600">–û–¥–æ–±—Ä–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                                            </div>
                                            <i class="fas fa-chevron-right text-gray-400"></i>
                                        </div>
                                    </button>
                                    
                                    <button onclick="loadSystemStats()" class="p-4 border rounded-lg text-left hover:bg-gray-50">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <div class="font-medium">üìä –°–∏—Å—Ç–µ–º–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
                                                <div class="text-sm text-gray-600">–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã</div>
                                            </div>
                                            <i class="fas fa-chevron-right text-gray-400"></i>
                                        </div>
                                    </button>
                                </div>
                            </div>
                            
                            <div id="admin-content" class="bg-white rounded-xl p-6 shadow hidden">
                                <div id="admin-data">–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –≤—ã—à–µ</div>
                            </div>
                        </div>
                    </div>
                    ` : ''}
                </div>
            `;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–∞—à–±–æ—Ä–¥–∞
            loadDashboardData();
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
        async function checkAuthentication() {
            // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
            const urlParams = new URLSearchParams(window.location.search);
            const autoToken = urlParams.get('token');
            if (autoToken) {
                authToken = autoToken;
                localStorage.setItem('auth_token', autoToken);
                // –û—á–∏—â–∞–µ–º URL –æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
                window.history.replaceState({}, document.title, window.location.pathname);
                await loadUserData();
                if (isAuthenticated) {
                    showMainInterface();
                    return;
                }
            }

            const savedToken = localStorage.getItem('auth_token');
            if (savedToken) {
                authToken = savedToken;
                await loadUserData();
                if (isAuthenticated) {
                    showMainInterface();
                } else {
                    // –¢–æ–∫–µ–Ω –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω, —É–¥–∞–ª—è–µ–º –µ–≥–æ
                    localStorage.removeItem('auth_token');
                    showTelegramLoginMessage();
                }
            } else {
                showTelegramLoginMessage();
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function updateUserInterface() {
            const userInfo = document.getElementById('user-info');
            if (userInfo && currentUser) {
                userInfo.textContent = currentUser.username || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
            }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
            document.querySelectorAll('[id^="tab-"]').forEach(btn => {
                btn.classList.remove('tab-active');
                btn.classList.add('hover:bg-gray-100');
            });
            
            const contentElement = document.getElementById(`content-${tabName}`);
            const activeBtn = document.getElementById(`tab-${tabName}`);
            
            if (contentElement && activeBtn) {
                contentElement.classList.remove('hidden');
                activeBtn.classList.add('tab-active');
                activeBtn.classList.remove('hover:bg-gray-100');
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏
                if (tabName === 'orders') {
                    loadOrders();
                }
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–∞—à–±–æ—Ä–¥–∞
        async function loadDashboardData() {
            try {
                const response = await fetch('/api/v1/analytics/summary', {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('total-orders').textContent = data.total_orders || 0;
                    document.getElementById('total-files').textContent = data.total_files || 0;
                    
                    const statsDiv = document.getElementById('dashboard-stats');
                    if (statsDiv) {
                        statsDiv.innerHTML = `
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div>
                                    <div class="font-medium">–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Å–µ–≥–æ–¥–Ω—è</div>
                                    <div class="text-blue-600">${data.processed_today || 0}</div>
                                </div>
                                <div>
                                    <div class="font-medium">–ê–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                                    <div class="text-green-600">${data.active_users || 0}</div>
                                </div>
                            </div>
                        `;
                    }
                }
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤
        async function loadOrders() {
            try {
                const response = await fetch('/api/v1/orders?page=1&page_size=20', {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    const ordersList = document.getElementById('orders-list');
                    
                    if (data.orders && data.orders.length > 0) {
                        ordersList.innerHTML = data.orders.map(order => `
                            <div class="bg-white rounded-lg p-4 shadow mb-3">
                                <div class="flex justify-between items-center mb-2">
                                    <div class="font-medium">#${order.order_number}</div>
                                    <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded">${order.payment_status}</span>
                                </div>
                                <div class="text-sm text-gray-600">–ê–≤—Ç–æ–º–∞—Ç: ${order.machine_code}</div>
                                <div class="text-sm font-medium">${order.order_price} ‚Ç∏</div>
                            </div>
                        `).join('');
                    } else {
                        ordersList.innerHTML = `
                            <div class="text-center py-8">
                                <i class="fas fa-inbox text-4xl text-gray-300 mb-4"></i>
                                <p class="text-gray-500">–ó–∞–∫–∞–∑—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
                            </div>
                        `;
                    }
                }
            } catch (error) {
                console.error('Error loading orders:', error);
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
        document.addEventListener('DOMContentLoaded', function() {
            const fileInput = document.getElementById('file-input');
            if (fileInput) {
                fileInput.addEventListener('change', async function(e) {
                    const files = e.target.files;
                    if (files.length > 0) {
                        await uploadFiles(files);
                    }
                });
            }
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
        async function uploadFiles(files) {
            const progressDiv = document.getElementById('upload-progress');
            const progressBar = document.getElementById('progress-bar');
            const statusText = document.getElementById('upload-status');
            
            progressDiv.classList.remove('hidden');
            
            const formData = new FormData();
            for (let file of files) {
                formData.append('files', file);
            }
            
            try {
                const response = await fetch('/api/v1/files/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: formData
                });
                
                if (response.ok) {
                    progressBar.style.width = '100%';
                    statusText.textContent = '–§–∞–π–ª—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!';
                    
                    if (tg) {
                        tg.showAlert(`–£—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ —Ñ–∞–π–ª–æ–≤: ${files.length}`);
                    }
                    
                    setTimeout(() => {
                        progressDiv.classList.add('hidden');
                        progressBar.style.width = '0%';
                    }, 2000);
                } else {
                    throw new Error('Upload failed');
                }
            } catch (error) {
                console.error('Upload error:', error);
                statusText.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤';
                if (tg) {
                    tg.showAlert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤');
                }
            }
        }

        // –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
        async function exportData(format) {
            const exportType = document.getElementById('export-type').value;
            
            try {
                const response = await fetch('/api/v1/export', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        export_type: exportType,
                        export_format: format
                    })
                });
                
                if (response.ok) {
                    if (tg) {
                        tg.showAlert(`–≠–∫—Å–ø–æ—Ä—Ç ${exportType} –≤ —Ñ–æ—Ä–º–∞—Ç–µ ${format.toUpperCase()} —Å–æ–∑–¥–∞–µ—Ç—Å—è...`);
                    }
                } else {
                    throw new Error('Export failed');
                }
            } catch (error) {
                console.error('Export error:', error);
                if (tg) {
                    tg.showAlert('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞');
                }
            }
        }

        // –ê–¥–º–∏–Ω—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
        async function loadPendingUsers() {
            if (currentUser?.role !== 'admin') return;
            
            try {
                const response = await fetch('/api/v1/users/pending', {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (response.ok) {
                    const users = await response.json();
                    const adminContent = document.getElementById('admin-content');
                    const adminData = document.getElementById('admin-data');
                    
                    adminContent.classList.remove('hidden');
                    
                    if (users.length > 0) {
                        adminData.innerHTML = `
                            <h4 class="font-semibold mb-4">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –æ–∂–∏–¥–∞—é—â–∏–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è:</h4>
                            <div class="space-y-3">
                                ${users.map(user => `
                                    <div class="flex items-center justify-between p-3 border rounded-lg">
                                        <div>
                                            <div class="font-medium">${user.first_name} ${user.last_name || ''}</div>
                                            <div class="text-sm text-gray-600">@${user.username}</div>
                                        </div>
                                        <button onclick="approveUser(${user.id})" class="bg-green-600 text-white px-3 py-1 rounded text-sm">
                                            –û–¥–æ–±—Ä–∏—Ç—å
                                        </button>
                                    </div>
                                `).join('')}
                            </div>
                        `;
                    } else {
                        adminData.innerHTML = '<p class="text-gray-600">–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ–∂–∏–¥–∞—é—â–∏—Ö –æ–¥–æ–±—Ä–µ–Ω–∏—è</p>';
                    }
                }
            } catch (error) {
                console.error('Error loading pending users:', error);
            }
        }

        // –û–¥–æ–±—Ä–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function approveUser(userId) {
            try {
                const response = await fetch(`/api/v1/users/${userId}/approve`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (response.ok) {
                    if (tg) {
                        tg.showAlert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–¥–æ–±—Ä–µ–Ω!');
                    }
                    loadPendingUsers(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫
                }
            } catch (error) {
                console.error('Error approving user:', error);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–∏—Å—Ç–µ–º–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        async function loadSystemStats() {
            if (currentUser?.role !== 'admin') return;
            
            const adminContent = document.getElementById('admin-content');
            const adminData = document.getElementById('admin-data');
            
            adminContent.classList.remove('hidden');
            adminData.innerHTML = `
                <h4 class="font-semibold mb-4">–°–∏—Å—Ç–µ–º–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</h4>
                <div class="grid grid-cols-2 gap-4">
                    <div class="p-4 bg-blue-50 rounded-lg">
                        <div class="text-2xl font-bold text-blue-600">-</div>
                        <div class="text-sm text-gray-600">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                    </div>
                    <div class="p-4 bg-green-50 rounded-lg">
                        <div class="text-2xl font-bold text-green-600">-</div>
                        <div class="text-sm text-gray-600">–ê–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π</div>
                    </div>
                </div>
                <p class="text-sm text-gray-500 mt-4">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>
            `;
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', function() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            checkAuthentication();
        });
    </script>
</body>
</html>
