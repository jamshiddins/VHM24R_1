<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VHM24R - –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞–º–∏</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        .loading { display: flex; justify-content: center; align-items: center; height: 50vh; }
        .hidden { display: none !important; }
        .error { background-color: #fee2e2; color: #dc2626; padding: 1rem; border-radius: 0.5rem; margin: 1rem 0; }
        .success { background-color: #dcfce7; color: #16a34a; padding: 1rem; border-radius: 0.5rem; margin: 1rem 0; }
        .progress-bar { transition: width 0.3s ease; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .btn { padding: 0.5rem 1rem; border-radius: 0.5rem; font-weight: 500; cursor: pointer; border: none; }
        .btn-primary { background-color: #3b82f6; color: white; }
        .btn-primary:hover { background-color: #2563eb; }
        .btn-success { background-color: #10b981; color: white; }
        .btn-success:hover { background-color: #059669; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div id="app" class="container mx-auto px-4 py-6 max-w-4xl">
        <!-- Header -->
        <header class="bg-white rounded-lg shadow-sm p-6 mb-6">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-2xl font-bold text-gray-800">VHM24R</h1>
                    <p class="text-gray-600">–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞–º–∏</p>
                </div>
                <div id="user-info" class="hidden">
                    <div class="text-right">
                        <p class="font-semibold" id="user-name"></p>
                        <p class="text-sm text-gray-500" id="user-status"></p>
                    </div>
                </div>
            </div>
        </header>

        <!-- Auth Section -->
        <div id="auth-section" class="bg-white rounded-lg shadow-sm p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h2>
            <div id="auth-status" class="mb-4">
                <p class="text-gray-600">–î–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–∏—Å—Ç–µ–º–æ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ Telegram</p>
            </div>
            <button id="telegram-login" class="btn btn-primary">
                –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Telegram
            </button>
        </div>

        <!-- Main Content -->
        <div id="main-content" class="hidden">
            <!-- Navigation Tabs -->
            <div class="bg-white rounded-lg shadow-sm mb-6">
                <nav class="flex space-x-1 p-2">
                    <button class="tab-btn px-4 py-2 rounded-md text-sm font-medium bg-blue-100 text-blue-700" data-tab="dashboard">
                        üìä –î–∞—à–±–æ—Ä–¥
                    </button>
                    <button class="tab-btn px-4 py-2 rounded-md text-sm font-medium text-gray-500 hover:text-gray-700" data-tab="upload">
                        üì§ –ó–∞–≥—Ä—É–∑–∫–∞
                    </button>
                    <button class="tab-btn px-4 py-2 rounded-md text-sm font-medium text-gray-500 hover:text-gray-700" data-tab="orders">
                        üìã –ó–∞–∫–∞–∑—ã
                    </button>
                    <button class="tab-btn px-4 py-2 rounded-md text-sm font-medium text-gray-500 hover:text-gray-700" data-tab="analytics">
                        üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
                    </button>
                </nav>
            </div>

            <!-- Dashboard Tab -->
            <div id="tab-dashboard" class="tab-content active">
                <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                    <div class="bg-white p-4 rounded-lg shadow-sm">
                        <div class="flex items-center">
                            <div class="p-2 bg-blue-100 rounded-lg">
                                <span class="text-2xl">üìÅ</span>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm text-gray-500">–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤</p>
                                <p class="text-lg font-semibold" id="total-files">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-sm">
                        <div class="flex items-center">
                            <div class="p-2 bg-green-100 rounded-lg">
                                <span class="text-2xl">üìã</span>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm text-gray-500">–ó–∞–∫–∞–∑–æ–≤</p>
                                <p class="text-lg font-semibold" id="total-orders">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-sm">
                        <div class="flex items-center">
                            <div class="p-2 bg-yellow-100 rounded-lg">
                                <span class="text-2xl">‚è≥</span>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm text-gray-500">–û–±—Ä–∞–±–æ—Ç–∫–∞</p>
                                <p class="text-lg font-semibold" id="processing-files">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-sm">
                        <div class="flex items-center">
                            <div class="p-2 bg-purple-100 rounded-lg">
                                <span class="text-2xl">üë•</span>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm text-gray-500">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</p>
                                <p class="text-lg font-semibold" id="total-users">0</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Upload Tab -->
            <div id="tab-upload" class="tab-content">
                <div class="bg-white rounded-lg shadow-sm p-6">
                    <h3 class="text-lg font-semibold mb-4">üì§ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤</h3>
                    
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center" id="drop-zone">
                        <input type="file" id="file-input" multiple accept=".csv,.xls,.xlsx,.pdf,.doc,.docx,.json,.xml,.zip,.rar,.txt,.tsv" class="hidden">
                        <div class="cursor-pointer">
                            <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                                <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                            <p class="text-lg text-gray-600 mb-2">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã —Å—é–¥–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</p>
                            <p class="text-sm text-gray-500">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: CSV, XLS, XLSX, PDF, DOC, DOCX, JSON, XML, ZIP, RAR, TXT, TSV (–¥–æ 100MB)</p>
                        </div>
                    </div>
                    
                    <div id="upload-progress" class="hidden mt-4">
                        <div class="bg-gray-200 rounded-full h-2">
                            <div id="progress-bar" class="bg-blue-600 h-2 rounded-full progress-bar" style="width: 0%"></div>
                        </div>
                        <p id="progress-text" class="text-sm text-gray-600 mt-2">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                    </div>
                </div>
            </div>

            <!-- Orders Tab -->
            <div id="tab-orders" class="tab-content">
                <div class="bg-white rounded-lg shadow-sm p-6">
                    <h3 class="text-lg font-semibold mb-4">üìã –ó–∞–∫–∞–∑—ã</h3>
                    <div class="mb-4 flex space-x-4">
                        <input type="text" id="search-order" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É –∑–∞–∫–∞–∑–∞" class="border rounded-lg px-3 py-2 flex-1">
                        <button id="search-btn" class="btn btn-primary">–ü–æ–∏—Å–∫</button>
                        <button id="export-btn" class="btn btn-success">–≠–∫—Å–ø–æ—Ä—Ç</button>
                    </div>
                    <div id="orders-list" class="space-y-2">
                        <p class="text-gray-500">–ó–∞–∫–∞–∑—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
                    </div>
                </div>
            </div>

            <!-- Analytics Tab -->
            <div id="tab-analytics" class="tab-content">
                <div class="bg-white rounded-lg shadow-sm p-6">
                    <h3 class="text-lg font-semibold mb-4">üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h3>
                    <div id="analytics-content">
                        <p class="text-gray-500">–ó–∞–≥—Ä—É–∑–∫–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Messages -->
        <div id="messages"></div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        const API_BASE = '/api/v1';
        let authToken = localStorage.getItem('auth_token');
        let currentUser = null;

        // Telegram WebApp
        const tg = window.Telegram?.WebApp;
        if (tg) {
            tg.ready();
            tg.expand();
        }

        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const authSection = document.getElementById('auth-section');
        const mainContent = document.getElementById('main-content');
        const userInfo = document.getElementById('user-info');
        const telegramLoginBtn = document.getElementById('telegram-login');
        const fileInput = document.getElementById('file-input');
        const dropZone = document.getElementById('drop-zone');
        const uploadProgress = document.getElementById('upload-progress');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const messagesDiv = document.getElementById('messages');

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', async () => {
            if (authToken) {
                await checkAuth();
            }
            setupEventListeners();
            setupTabs();
        });

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–∞–±–æ–≤
        function setupTabs() {
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');

            tabBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const tabId = btn.dataset.tab;
                    
                    // –î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ç–∞–±—ã
                    tabBtns.forEach(b => {
                        b.classList.remove('bg-blue-100', 'text-blue-700');
                        b.classList.add('text-gray-500', 'hover:text-gray-700');
                    });
                    tabContents.forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ç–∞–±
                    btn.classList.add('bg-blue-100', 'text-blue-700');
                    btn.classList.remove('text-gray-500', 'hover:text-gray-700');
                    document.getElementById(`tab-${tabId}`).classList.add('active');
                    
                    // –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–∞–±–∞
                    loadTabData(tabId);
                });
            });
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            // Telegram login
            telegramLoginBtn.addEventListener('click', loginWithTelegram);

            // File upload
            fileInput.addEventListener('change', handleFileSelect);
            dropZone.addEventListener('click', () => fileInput.click());
            dropZone.addEventListener('dragover', handleDragOver);
            dropZone.addEventListener('drop', handleDrop);

            // Search
            document.getElementById('search-btn').addEventListener('click', searchOrders);
            document.getElementById('export-btn').addEventListener('click', exportData);
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        async function checkAuth() {
            try {
                const response = await fetch(`${API_BASE}/auth/me`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    currentUser = await response.json();
                    showMainContent();
                } else {
                    localStorage.removeItem('auth_token');
                    authToken = null;
                }
            } catch (error) {
                console.error('Auth check failed:', error);
                localStorage.removeItem('auth_token');
                authToken = null;
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç
        function showMainContent() {
            authSection.classList.add('hidden');
            mainContent.classList.remove('hidden');
            userInfo.classList.remove('hidden');
            
            document.getElementById('user-name').textContent = currentUser.username || currentUser.first_name;
            document.getElementById('user-status').textContent = `–°—Ç–∞—Ç—É—Å: ${currentUser.status}`;
            
            loadTabData('dashboard');
        }

        // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram
        async function loginWithTelegram() {
            if (tg && tg.initDataUnsafe?.user) {
                const user = tg.initDataUnsafe.user;
                const authData = {
                    id: user.id,
                    first_name: user.first_name,
                    last_name: user.last_name,
                    username: user.username,
                    photo_url: user.photo_url,
                    auth_date: Math.floor(Date.now() / 1000),
                    hash: tg.initData
                };

                try {
                    const response = await fetch(`${API_BASE}/auth/telegram`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(authData)
                    });

                    if (response.ok) {
                        const data = await response.json();
                        authToken = data.access_token;
                        localStorage.setItem('auth_token', authToken);
                        currentUser = data.user;
                        showMainContent();
                        showMessage('–£—Å–ø–µ—à–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è!', 'success');
                    } else {
                        const error = await response.json();
                        showMessage(error.detail || '–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏', 'error');
                    }
                } catch (error) {
                    showMessage('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É', 'error');
                }
            } else {
                showMessage('–î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –≤ Telegram WebApp', 'error');
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ç–∞–±–∞
        async function loadTabData(tabId) {
            if (!authToken) return;

            try {
                switch (tabId) {
                    case 'dashboard':
                        await loadDashboard();
                        break;
                    case 'orders':
                        await loadOrders();
                        break;
                    case 'analytics':
                        await loadAnalytics();
                        break;
                }
            } catch (error) {
                console.error(`Error loading ${tabId}:`, error);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞—à–±–æ—Ä–¥–∞
        async function loadDashboard() {
            try {
                const response = await fetch(`${API_BASE}/analytics`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('total-files').textContent = data.total_files || 0;
                    document.getElementById('total-orders').textContent = data.total_orders || 0;
                    document.getElementById('processing-files').textContent = data.processing_files || 0;
                    document.getElementById('total-users').textContent = data.total_users || 0;
                }
            } catch (error) {
                console.error('Error loading dashboard:', error);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤
        async function loadOrders() {
            try {
                const response = await fetch(`${API_BASE}/orders`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    const orders = await response.json();
                    displayOrders(orders);
                }
            } catch (error) {
                console.error('Error loading orders:', error);
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤
        function displayOrders(orders) {
            const ordersList = document.getElementById('orders-list');
            
            if (orders.length === 0) {
                ordersList.innerHTML = '<p class="text-gray-500">–ó–∞–∫–∞–∑—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>';
                return;
            }

            ordersList.innerHTML = orders.map(order => `
                <div class="border rounded-lg p-4 hover:bg-gray-50">
                    <div class="flex justify-between items-start">
                        <div>
                            <h4 class="font-medium">${order.order_number || '–ë–µ–∑ –Ω–æ–º–µ—Ä–∞'}</h4>
                            <p class="text-sm text-gray-500">–°—Ç–∞—Ç—É—Å: ${order.status}</p>
                            <p class="text-sm text-gray-500">–î–∞—Ç–∞: ${new Date(order.created_at).toLocaleString('ru')}</p>
                        </div>
                        <div class="text-right">
                            <span class="inline-block px-2 py-1 text-xs rounded-full ${getStatusColor(order.status)}">
                                ${order.status}
                            </span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // –¶–≤–µ—Ç —Å—Ç–∞—Ç—É—Å–∞
        function getStatusColor(status) {
            switch (status) {
                case 'completed': return 'bg-green-100 text-green-800';
                case 'processing': return 'bg-yellow-100 text-yellow-800';
                case 'pending': return 'bg-gray-100 text-gray-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
        async function loadAnalytics() {
            const analyticsContent = document.getElementById('analytics-content');
            analyticsContent.innerHTML = '<p class="text-gray-500">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞</p>';
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–æ–≤
        function handleFileSelect(event) {
            const files = Array.from(event.target.files);
            uploadFiles(files);
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ drag & drop
        function handleDragOver(event) {
            event.preventDefault();
            dropZone.classList.add('border-blue-500', 'bg-blue-50');
        }

        function handleDrop(event) {
            event.preventDefault();
            dropZone.classList.remove('border-blue-500', 'bg-blue-50');
            const files = Array.from(event.dataTransfer.files);
            uploadFiles(files);
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
        async function uploadFiles(files) {
            if (!authToken) {
                showMessage('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è', 'error');
                return;
            }

            if (files.length === 0) return;

            const formData = new FormData();
            files.forEach(file => {
                formData.append('files', file);
            });

            uploadProgress.classList.remove('hidden');
            progressBar.style.width = '0%';
            progressText.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤...';

            try {
                const xhr = new XMLHttpRequest();
                
                xhr.upload.addEventListener('progress', (event) => {
                    if (event.lengthComputable) {
                        const percentComplete = (event.loaded / event.total) * 100;
                        progressBar.style.width = `${percentComplete}%`;
                        progressText.textContent = `–ó–∞–≥—Ä—É–∂–µ–Ω–æ: ${Math.round(percentComplete)}%`;
                    }
                });

                xhr.addEventListener('load', () => {
                    uploadProgress.classList.add('hidden');
                    if (xhr.status === 200) {
                        const response = JSON.parse(xhr.responseText);
                        showMessage(`–£—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ ${files.length} —Ñ–∞–π–ª–æ–≤`, 'success');
                        loadTabData('dashboard'); // –û–±–Ω–æ–≤–∏—Ç—å –¥–∞—à–±–æ—Ä–¥
                    } else {
                        const error = JSON.parse(xhr.responseText);
                        showMessage(error.detail || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏', 'error');
                    }
                });

                xhr.addEventListener('error', () => {
                    uploadProgress.classList.add('hidden');
                    showMessage('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É', 'error');
                });

                xhr.open('POST', `${API_BASE}/upload`);
                xhr.setRequestHeader('Authorization', `Bearer ${authToken}`);
                xhr.send(formData);

            } catch (error) {
                uploadProgress.classList.add('hidden');
                showMessage('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤', 'error');
            }
        }

        // –ü–æ–∏—Å–∫ –∑–∞–∫–∞–∑–æ–≤
        async function searchOrders() {
            const query = document.getElementById('search-order').value.trim();
            if (!query) {
                loadOrders();
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/orders?search=${encodeURIComponent(query)}`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    const orders = await response.json();
                    displayOrders(orders);
                }
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞', 'error');
            }
        }

        // –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
        async function exportData() {
            if (!authToken) {
                showMessage('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/export`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        format: 'xlsx',
                        include_changes: true
                    })
                });

                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `vhm24r_export_${new Date().toISOString().split('T')[0]}.xlsx`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                    showMessage('–î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã', 'success');
                } else {
                    showMessage('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞', 'error');
                }
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö', 'error');
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
        function showMessage(text, type = 'info') {
            const messageEl = document.createElement('div');
            messageEl.className = `${type} rounded-lg p-4 mb-4`;
            messageEl.textContent = text;
            
            messagesDiv.appendChild(messageEl);
            
            setTimeout(() => {
                messageEl.remove();
            }, 5000);
        }
    </script>
</body>
</html>
